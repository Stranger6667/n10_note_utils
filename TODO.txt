* normalize_text_line: markdown marker不应该参与normalize，主要是“中文标点前后都不需要空格”这一点，比如"# 【测试】标题"，还有比如"# )xxx"这样的，虽然不规范，但也是一个level1 heading

multiline cell中如果出现 "* item1{nl}* 【item2】"这样的，仍然会导致问题呀

    list_markers_re = regex.compile(r'[ ]*(?P<markdown_marker>[-*+]|[0-9]+\.|Q:|q:|A:|a:)[ ]')
    blockquote_re = regex.compile(r'[ ]{,3}(?P<quote_marker>>(?:$|[> ]*))')
    markdown_header_re = regex.compile(r'[ ]{,3}(?P<header_marker>#{1,6})[ ]')
	
多个空格被缩减为一个也会导致multiline cell中的缩进失效！！！

multiline cell太复杂了！！！

由于note processor处理的对象是摘抄笔记，出现multiline cell的情况应该极少，所以我暂时不考虑处理这种复杂的情形


--------------------

{{html2markdown}}: 优先处理html, 如果没有，则当text处理

会遇到四种情况：
* 只有text
* 只有html
* 先on_text后on_html
* 先on_html后on_text

有的软件text和html会分开来存放, 所以，如果先遇到on_html，随后的on_text不一定是一伙的！！！


只能放到on_update来实现，因为这里有所有数据：

on_text --> on_text: 如果数据一致，则跳过 ---> on_html: 如果此时text的内容和之前on_text收到的一致，则是一伙的，转为markdown写入Notes.md

on_text --> on_text: 如果数据不一致，说明这是另一次拷贝，将前一个的on_text放入到work queue，再把当前的也放入work queue

on_html -> 转为markdown写入Notes.md -> on_text，如果此时html值之 前的on_html的一致，则是一伙的，跳过，如果没有html值，则不是一伙的 -> on_text: 如果数据一致，则跳过，如果不一致，说明是另一次拷贝

上述流程中，如果遇到特殊的marker，则认为前一个流程已经走完了，按当前情况进行处理

这种处理流程有一个缺点：如果先遇到text，则不能立即写入文件，需要等待下一次的剪贴板变化，如果用户不再拷贝文字了，就要想办法在适当的时机写入，所以这里还涉及到定时器，这个定时器的时间该是多长呢？以adobe acrobat的一次流程为准，这是目前遇最复杂的， 大约400ms， 500ms是比较好的

1671894407.7902896: update message received: 10320
num clips: 0
1671894407.8305204: update message received: 10325
close clipboard error
get clipboard content failed
WNDPROC return value cannot be converted to LRESULT
TypeError: WPARAM is simple, so must be an int object (got NoneType)
1671894407.8416722: update message received: 10328
num clips: 1
on text, seq_no: 10328
window title: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
page number and filename image grabed.
extract_filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf
1671894408.1203141: update message received: 10328
clipboard sequence number not changed, ignore
WNDPROC return value cannot be converted to LRESULT
TypeError: WPARAM is simple, so must be an int object (got NoneType)
page number ocr: WF

page number: None
page number ocr: 99 (114 of 353)

page number: 114


----------------------
1671894451.0102723: update message received: 10334
num clips: 0
1671894451.0401735: update message received: 10339
close clipboard error
get clipboard content failed
WNDPROC return value cannot be converted to LRESULT
TypeError: WPARAM is simple, so must be an int object (got NoneType)
1671894451.0401735: update message received: 10341
num clips: 1
on text, seq_no: 10342
window title: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
page number and filename image grabed.
extract_filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf
1671894451.2868586: update message received: 10342
clipboard sequence number not changed, ignore
WNDPROC return value cannot be converted to LRESULT
TypeError: WPARAM is simple, so must be an int object (got NoneType)
page number ocr: WF

page number: None
page number ocr: 99 (114 of 353)

page number: 114

-----


1671896358.292684: update message received: 10394
num clips: 0
1671896358.340153: update message received: 10399
close clipboard error
get clipboard content failed
WNDPROC return value cannot be converted to LRESULT
TypeError: WPARAM is simple, so must be an int object (got NoneType)
1671896358.340153: update message received: 10401
num clips: 1
on text, seq_no: 10401
window title: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
page number and filename image grabed.
1671896358.6864548: update message received: 10402
extract_filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf - Adobe Acrobat Pro DC (64-bit)
filename: Martin H. Manser, David Pickering, Rosalind Fergusson, Jonathon Green, Jenny Roberts, Elizabeth McLaren Kirkpatrick - Good Word Guide_ The Fast Way to Correct English_ Spelling, Punctuation, Grammar a.pdf
num clips: 1
on text, seq_no: 10402
duplicate text, ignore            ---> 查词典的时候，无法区分这个是自动的还是人工的，怎么办？时间太我接近，则认为是一伙的
page number ocr: WF

page number: None
page number ocr: 99 (114 of 353)

page number: 114


---------


on_update如何实现呢？

-> 内容发生改变（注意：不是seqno发生改变）即意味着一个新的session的开始，计时器复位
-> 计时器到0时，将内容放入queue  (session.finish())
-> 如果能提前确定内容，则可以提前放入queue，session销毁，等待用户的下一次拷贝
	-> 尽管session会销毁，但是last_text仍然会保留，如果用户拷贝的内容重户，会跳过，不会创建session
	-> 如果计时器到0和确定内容在同一时间，如何避免冲突？
	-> 如果计时器到0 finish之后，随后的clipboard update的内容和前一个session相关怎么办？ (所以last_html也要保留，即：前一个session不能销毁，只是finish()后将timer停掉而已，last_session)
-> decorator修饰后的结果如果是none，则不需要创建transaction
	
	
两个session相等的条件：

* 如果有html和text: 则需要两者都相等
* 如果只有html和text之一，则任意一个匹配都认为相等


查字典这种情形怎么办？

* 这种情形是意味着前一个session要finish()，但不必为{{lookupdictionary}}这个text创建session
* 会创建一个decorator，用于修饰下一个transaction